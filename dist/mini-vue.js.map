{"version":3,"file":"mini-vue.js","sources":["../src/utils/index.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isObject(value) {\n  return value !== null && typeof value === 'object';\n}\n\n// 定义属性\nexport function def(obj, key, val, enumerable) {\n  Object.defineProperty(obj, key, {\n    value: val,\n    enumerable: !!enumerable,\n    configurable: true,\n    writable: true,\n  });\n}\n","import { def } from '../utils/index';\n\n// 原生数组原型\nconst arrayProto = Array.prototype;\n// arrayMethods 继承数组原型\nexport const arrayMethods = Object.create(arrayProto);\n\n// 拦截这 7 个会改变元数组的方法\nconst methodsToPatch = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse',\n];\n\n// 拦截数组方法\n// eslint-disable-next-line prefer-arrow-callback\nmethodsToPatch.forEach(function (method) {\n  const original = arrayProto[method];\n\n  def(arrayMethods, method, function (...args) {\n    const result = original.apply(this, args);\n    const ob = this.__ob__;\n    // 数组有新增的元素\n    let inserted;\n    // eslint-disable-next-line default-case\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args;\n        break;\n      case 'splice':\n        inserted = args.slice(2);\n        break;\n    }\n    // 新增的元素 也进行响应式观测\n    if (inserted) ob.observeArray(inserted);\n    return result;\n  });\n});\n","import { isObject, def } from '../utils/index';\nimport { arrayMethods } from './array';\n\nclass Observe {\n  constructor(value) {\n    // 增加 __ob__ 属性\n    def(value, '__ob__', this);\n    if (Array.isArray(value)) {\n      value.__proto__ = arrayMethods;\n      this.observeArray(value);\n    } else {\n      this.walk(value);\n    }\n  }\n\n  // 对象\n  walk(obj) {\n    const keys = Object.keys(obj);\n    for (let i = 0; i < keys.length; i++) {\n      defineReactive(obj, keys[i], obj[keys[i]]);\n    }\n  }\n\n  // 数组\n  observeArray(items) {\n    for (let i = 0; i < items.length; i++) {\n      observe(items[i]);\n    }\n  }\n}\n\n// 数据响应式（核心）\nexport function defineReactive(obj, key, val) {\n  // 递归，使对象值也进行响应式\n  observe(val);\n  // 数据劫持\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get() {\n      console.log(`🚀 ~ 访问值 ${key}`, val);\n      return val;\n    },\n    set(value) {\n      val = value;\n      console.log(`🚀 ~ 设置值 ${key}`, value);\n    },\n  });\n}\n\nexport function observe(value) {\n  if (isObject(value) || Array.isArray(value)) {\n    return new Observe(value);\n  }\n}\n","import { observe } from './observer/index';\n\n// 数据代理\nexport function proxy(target, sourceKey, key) {\n  Object.defineProperty(target, key, {\n    enumerable: true,\n    configurable: true,\n    get() {\n      return target[sourceKey][key];\n    },\n    set(val) {\n      target[sourceKey][key] = val;\n    },\n  });\n}\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.props) {\n    initProps(vm);\n  }\n\n  if (opts.methods) {\n    initMethods(vm);\n  }\n\n  if (opts.data) {\n    initData(vm);\n  }\n\n  if (opts.computed) {\n    initComputed(vm);\n  }\n\n  if (opts.watch) {\n    initWatch(vm);\n  }\n}\n\nfunction initProps() {}\n\nfunction initMethods() {}\n\nfunction initData(vm) {\n  // 传入的 data\n  let { data } = vm.$options;\n\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data || {};\n  console.log('🚀 ~ file: state.js ~ line 33 ~ initData ~ data', data);\n\n  // 将 data 代理到 vm 上，可通过 this.dataKey 访问\n  for (const key in data) {\n    if (Object.hasOwnProperty.call(data, key)) {\n      proxy(vm, '_data', key);\n    }\n  }\n\n  // 观测数据 -- 响应式数据核心\n  observe(data);\n}\n\nfunction initComputed() {}\n\nfunction initWatch() {}\n","import { initState } from './state';\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n\n    // 初始化状态\n    initState(vm);\n  };\n}\n","import { initMixin } from './init';\n\nfunction Vue(options) {\n  // 初始化\n  this._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;\n"],"names":["isObject","value","def","obj","key","val","enumerable","Object","defineProperty","configurable","writable","arrayProto","Array","prototype","arrayMethods","create","methodsToPatch","forEach","method","original","args","result","apply","ob","__ob__","inserted","slice","observeArray","Observe","isArray","__proto__","walk","keys","i","length","defineReactive","items","observe","get","console","log","set","proxy","target","sourceKey","initState","vm","opts","$options","props","methods","data","initData","computed","watch","_data","call","hasOwnProperty","initMixin","Vue","_init","options"],"mappings":"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"}